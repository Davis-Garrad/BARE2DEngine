\hypertarget{_pico_p_n_g_8cpp_source}{}\doxysection{Pico\+PNG.\+cpp}
\label{_pico_p_n_g_8cpp_source}\index{Other\_Libraries/PicoPNG.cpp@{Other\_Libraries/PicoPNG.cpp}}
\mbox{\hyperlink{_pico_p_n_g_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00001}00001 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00003}00003 \textcolor{keyword}{using namespace }std;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00004}00004 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00005}00005 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_b_a_r_e2_d}{BARE2D}} \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00007}00007     \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00008}00008 \textcolor{comment}{    decodePNG: The picoPNG function, decodes a PNG file buffer in memory, into a raw pixel buffer.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00009}00009 \textcolor{comment}{    out\_image: output parameter, this will contain the raw pixels after decoding.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00010}00010 \textcolor{comment}{    By default the output is 32-\/bit RGBA color.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00011}00011 \textcolor{comment}{    The std::vector is automatically resized to the correct size.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00012}00012 \textcolor{comment}{    image\_width: output\_parameter, this will contain the width of the image in pixels.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00013}00013 \textcolor{comment}{    image\_height: output\_parameter, this will contain the height of the image in pixels.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00014}00014 \textcolor{comment}{    in\_png: pointer to the buffer of the PNG file in memory. To get it from a file on}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00015}00015 \textcolor{comment}{    disk, load it and store it in a memory buffer yourself first.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00016}00016 \textcolor{comment}{    in\_size: size of the input PNG file in bytes.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00017}00017 \textcolor{comment}{    convert\_to\_rgba32: optional parameter, true by default.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00018}00018 \textcolor{comment}{    Set to true to get the output in RGBA 32-\/bit (8 bit per channel) color format}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00019}00019 \textcolor{comment}{    no matter what color type the original PNG image had. This gives predictable,}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00020}00020 \textcolor{comment}{    useable data from any random input PNG.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00021}00021 \textcolor{comment}{    Set to false to do no color conversion at all. The result then has the same data}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00022}00022 \textcolor{comment}{    type as the PNG image, which can range from 1 bit to 64 bits per pixel.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00023}00023 \textcolor{comment}{    Information about the color type or palette colors are not provided. You need}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00024}00024 \textcolor{comment}{    to know this information yourself to be able to use the data so this only}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00025}00025 \textcolor{comment}{    works for trusted PNG files. Use LodePNG instead of picoPNG if you need this information.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00026}00026 \textcolor{comment}{    return: 0 if success, not 0 if some error occured.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00027}00027 \textcolor{comment}{    */}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00028}\mbox{\hyperlink{namespace_b_a_r_e2_d_a480b5f334854e31c2d7e026933129480}{00028}}     \textcolor{keywordtype}{int} \mbox{\hyperlink{namespace_b_a_r_e2_d_a480b5f334854e31c2d7e026933129480}{decodePNG}}(std::vector<unsigned char>\& out\_image, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& image\_width, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& image\_height, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in\_png, std::size\_t in\_size, \textcolor{keywordtype}{bool} convert\_to\_rgba32)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00029}00029     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00030}00030         \textcolor{comment}{// picoPNG version 20101224}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00031}00031         \textcolor{comment}{// Copyright (c) 2005-\/2010 Lode Vandevenne}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00032}00032         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00033}00033         \textcolor{comment}{// This software is provided 'as-\/is', without any express or implied}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00034}00034         \textcolor{comment}{// warranty. In no event will the authors be held liable for any damages}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00035}00035         \textcolor{comment}{// arising from the use of this software.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00036}00036         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00037}00037         \textcolor{comment}{// Permission is granted to anyone to use this software for any purpose,}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00038}00038         \textcolor{comment}{// including commercial applications, and to alter it and redistribute it}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00039}00039         \textcolor{comment}{// freely, subject to the following restrictions:}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00040}00040         \textcolor{comment}{//}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00041}00041         \textcolor{comment}{//     1. The origin of this software must not be misrepresented; you must not}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00042}00042         \textcolor{comment}{//     claim that you wrote the original software. If you use this software}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00043}00043         \textcolor{comment}{//     in a product, an acknowledgment in the product documentation would be}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00044}00044         \textcolor{comment}{//     appreciated but is not required.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00045}00045         \textcolor{comment}{//     2. Altered source versions must be plainly marked as such, and must not be}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00046}00046         \textcolor{comment}{//     misrepresented as being the original software.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00047}00047         \textcolor{comment}{//     3. This notice may not be removed or altered from any source distribution.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00049}00049         \textcolor{comment}{// picoPNG is a PNG decoder in one C++ function of around 500 lines. Use picoPNG for}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00050}00050         \textcolor{comment}{// programs that need only 1 .cpp file. Since it's a single function, it's very limited,}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00051}00051         \textcolor{comment}{// it can convert a PNG to raw pixel data either converted to 32-\/bit RGBA color or}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00052}00052         \textcolor{comment}{// with no color conversion at all. For anything more complex, another tiny library}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00053}00053         \textcolor{comment}{// is available: LodePNG (lodepng.c(pp)), which is a single source and header file.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00054}00054         \textcolor{comment}{// Apologies for the compact code style, it's to make this tiny.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00055}00055 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00056}00056         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LENBASE[29] = \{ 3, 4, 5, 6, 7, 8, 9, 10, 11, 13, 15, 17, 19, 23, 27, 31, 35, 43, 51, 59, 67, 83, 99, 115, 131, 163, 195, 227, 258 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00057}00057         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LENEXTRA[29] = \{ 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00058}00058         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} DISTBASE[30] = \{ 1, 2, 3, 4, 5, 7, 9, 13, 17, 25, 33, 49, 65, 97, 129, 193, 257, 385, 513, 769, 1025, 1537, 2049, 3073, 4097, 6145, 8193, 12289, 16385, 24577 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00059}00059         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} DISTEXTRA[30] = \{ 0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00060}00060         \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} CLCL[19] = \{ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 \}; \textcolor{comment}{//code length code lengths}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00061}00061         \textcolor{keyword}{struct }Zlib \textcolor{comment}{//nested functions for zlib decompression}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00062}00062         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00063}00063             \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} readBitFromStream(\textcolor{keywordtype}{size\_t}\& bitp, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* bits) \{ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} result = (bits[bitp >> 3] >> (bitp \& 0x7)) \& 1; bitp++; \textcolor{keywordflow}{return} result; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00064}00064             \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} readBitsFromStream(\textcolor{keywordtype}{size\_t}\& bitp, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* bits, \textcolor{keywordtype}{size\_t} nbits)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00065}00065             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00066}00066                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} result = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00067}00067                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < nbits; i++) result += (readBitFromStream(bitp, bits)) << i;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00068}00068                 \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00069}00069             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00070}00070             \textcolor{keyword}{struct }HuffmanTree}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00071}00071             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00072}00072                 \textcolor{keywordtype}{int} makeFromLengths(\textcolor{keyword}{const} std::vector<unsigned long>\& bitlen, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} maxbitlen)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00073}00073                 \{ \textcolor{comment}{//make tree given the lengths}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00074}00074                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} numcodes = (\textcolor{keywordtype}{unsigned} long)(bitlen.size()), treepos = 0, nodefilled = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00075}00075                     std::vector<unsigned long> tree1d(numcodes), blcount(maxbitlen + 1, 0), nextcode(maxbitlen + 1, 0);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00076}00076                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bits = 0; bits < numcodes; bits++) blcount[bitlen[bits]]++; \textcolor{comment}{//count number of instances of each code length}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00077}00077                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bits = 1; bits <= maxbitlen; bits++) nextcode[bits] = (nextcode[bits -\/ 1] + blcount[bits -\/ 1]) << 1;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00078}00078                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < numcodes; n++) \textcolor{keywordflow}{if} (bitlen[n] != 0) tree1d[n] = nextcode[bitlen[n]]++; \textcolor{comment}{//generate all the codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00079}00079                     tree2d.clear(); tree2d.resize(numcodes * 2, 32767); \textcolor{comment}{//32767 here means the tree2d isn't filled there yet}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00080}00080                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < numcodes; n++) \textcolor{comment}{//the codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00081}00081                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i = 0; i < bitlen[n]; i++) \textcolor{comment}{//the bits for this code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00082}00082                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00083}00083                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bit = (tree1d[n] >> (bitlen[n] -\/ i -\/ 1)) \& 1;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00084}00084                         \textcolor{keywordflow}{if} (treepos > numcodes -\/ 2) \textcolor{keywordflow}{return} 55;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00085}00085                         \textcolor{keywordflow}{if} (tree2d[2 * treepos + bit] == 32767) \textcolor{comment}{//not yet filled in}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00086}00086                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00087}00087                             \textcolor{keywordflow}{if} (i + 1 == bitlen[n]) \{ tree2d[2 * treepos + bit] = n; treepos = 0; \} \textcolor{comment}{//last bit}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00088}00088                             \textcolor{keywordflow}{else} \{ tree2d[2 * treepos + bit] = ++nodefilled + numcodes; treepos = nodefilled; \} \textcolor{comment}{//addresses are encoded as values > numcodes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00089}00089                         \} \textcolor{keywordflow}{else} treepos = tree2d[2 * treepos + bit] -\/ numcodes; \textcolor{comment}{//subtract numcodes from address to get address value}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00090}00090                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00091}00091                     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00092}00092                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00093}00093                 \textcolor{keywordtype}{int} decode(\textcolor{keywordtype}{bool}\& decoded, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long}\& result, \textcolor{keywordtype}{size\_t}\& treepos, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bit)\textcolor{keyword}{ const}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00094}00094 \textcolor{keyword}{                }\{ \textcolor{comment}{//Decodes a symbol from the tree}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00095}00095                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} numcodes = (\textcolor{keywordtype}{unsigned} long)tree2d.size() / 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00096}00096                     \textcolor{keywordflow}{if} (treepos >= numcodes) \textcolor{keywordflow}{return} 11; \textcolor{comment}{//error: you appeared outside the codetree}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00097}00097                     result = tree2d[2 * treepos + bit];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00098}00098                     decoded = (result < numcodes);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00099}00099                     treepos = decoded ? 0 : result -\/ numcodes;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00100}00100                     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00101}00101                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00102}00102                 std::vector<unsigned long> tree2d; \textcolor{comment}{//2D representation of a huffman tree: The one dimension is "{}0"{} or "{}1"{}, the other contains all nodes and leaves of the tree.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00103}00103             \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00104}00104             \textcolor{keyword}{struct }Inflator}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00105}00105             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00106}00106                 \textcolor{keywordtype}{int} error;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00107}00107                 \textcolor{keywordtype}{void} inflate(std::vector<unsigned char>\& out, \textcolor{keyword}{const} std::vector<unsigned char>\& in, \textcolor{keywordtype}{size\_t} inpos = 0)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00108}00108                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00109}00109                     \textcolor{keywordtype}{size\_t} bp = 0, pos = 0; \textcolor{comment}{//bit pointer and byte pointer}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00110}00110                     error = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00111}00111                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} BFINAL = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00112}00112                     \textcolor{keywordflow}{while} (!BFINAL \&\& !error)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00113}00113                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00114}00114                         \textcolor{keywordflow}{if} (bp >> 3 >= in.size()) \{ error = 52; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer will jump past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00115}00115                         BFINAL = readBitFromStream(bp, \&in[inpos]);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00116}00116                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} BTYPE = readBitFromStream(bp, \&in[inpos]); BTYPE += 2 * readBitFromStream(bp, \&in[inpos]);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00117}00117                         \textcolor{keywordflow}{if} (BTYPE == 3) \{ error = 20; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: invalid BTYPE}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00118}00118                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (BTYPE == 0) inflateNoCompression(out, \&in[inpos], bp, pos, in.size());}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00119}00119                         \textcolor{keywordflow}{else} inflateHuffmanBlock(out, \&in[inpos], bp, pos, in.size(), BTYPE);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00120}00120                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00121}00121                     \textcolor{keywordflow}{if} (!error) out.resize(pos); \textcolor{comment}{//Only now we know the true size of out, resize it to that}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00122}00122                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00123}00123                 \textcolor{keywordtype}{void} generateFixedTrees(HuffmanTree\& tree, HuffmanTree\& treeD) \textcolor{comment}{//get the tree of a deflated block with fixed tree}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00124}00124                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00125}00125                     std::vector<unsigned long> bitlen(288, 8), bitlenD(32, 5);;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00126}00126                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 144; i <= 255; i++) bitlen[i] = 9;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00127}00127                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 256; i <= 279; i++) bitlen[i] = 7;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00128}00128                     tree.makeFromLengths(bitlen, 15);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00129}00129                     treeD.makeFromLengths(bitlenD, 15);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00130}00130                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00131}00131                 HuffmanTree codetree, codetreeD, codelengthcodetree; \textcolor{comment}{//the code tree for Huffman codes, dist codes, and code length codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00132}00132                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} huffmanDecodeSymbol(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t}\& bp, \textcolor{keyword}{const} HuffmanTree\& codetree, \textcolor{keywordtype}{size\_t} inlength)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00133}00133                 \{ \textcolor{comment}{//decode a single symbol from given list of bits with given code tree. return value is the symbol}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00134}00134                     \textcolor{keywordtype}{bool} decoded; \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} ct;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00135}00135                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} treepos = 0;;)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00136}00136                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00137}00137                         \textcolor{keywordflow}{if} ((bp \& 0x07) == 0 \&\& (bp >> 3) > inlength) \{ error = 10; \textcolor{keywordflow}{return} 0; \} \textcolor{comment}{//error: end reached without endcode}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00138}00138                         error = codetree.decode(decoded, ct, treepos, readBitFromStream(bp, in)); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return} 0; \textcolor{comment}{//stop, an error happened}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00139}00139                         \textcolor{keywordflow}{if} (decoded) \textcolor{keywordflow}{return} ct;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00140}00140                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00141}00141                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00142}00142                 \textcolor{keywordtype}{void} getTreeInflateDynamic(HuffmanTree\& tree, HuffmanTree\& treeD, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t}\& bp, \textcolor{keywordtype}{size\_t} inlength)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00143}00143                 \{ \textcolor{comment}{//get the tree of a deflated block with dynamic tree, the tree itself is also Huffman compressed with a known tree}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00144}00144                     std::vector<unsigned long> bitlen(288, 0), bitlenD(32, 0);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00145}00145                     \textcolor{keywordflow}{if} (bp >> 3 >= inlength -\/ 2) \{ error = 49; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//the bit pointer is or will go past the memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00146}00146                     \textcolor{keywordtype}{size\_t} HLIT = readBitsFromStream(bp, in, 5) + 257; \textcolor{comment}{//number of literal/length codes + 257}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00147}00147                     \textcolor{keywordtype}{size\_t} HDIST = readBitsFromStream(bp, in, 5) + 1; \textcolor{comment}{//number of dist codes + 1}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00148}00148                     \textcolor{keywordtype}{size\_t} HCLEN = readBitsFromStream(bp, in, 4) + 4; \textcolor{comment}{//number of code length codes + 4}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00149}00149                     std::vector<unsigned long> codelengthcode(19); \textcolor{comment}{//lengths of tree to decode the lengths of the dynamic tree}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00150}00150                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < 19; i++) codelengthcode[CLCL[i]] = (i < HCLEN) ? readBitsFromStream(bp, in, 3) : 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00151}00151                     error = codelengthcodetree.makeFromLengths(codelengthcode, 7); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00152}00152                     \textcolor{keywordtype}{size\_t} i = 0, replength;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00153}00153                     \textcolor{keywordflow}{while} (i < HLIT + HDIST)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00154}00154                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00155}00155                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} code = huffmanDecodeSymbol(in, bp, codelengthcodetree, inlength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00156}00156                         \textcolor{keywordflow}{if} (code <= 15)  \{ \textcolor{keywordflow}{if} (i < HLIT) bitlen[i++] = code; \textcolor{keywordflow}{else} bitlenD[i++ -\/ HLIT] = code; \} \textcolor{comment}{//a length code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00157}00157                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == 16) \textcolor{comment}{//repeat previous}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00158}00158                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00159}00159                             \textcolor{keywordflow}{if} (bp >> 3 >= inlength) \{ error = 50; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer jumps past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00160}00160                             replength = 3 + readBitsFromStream(bp, in, 2);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00161}00161                             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} value; \textcolor{comment}{//set value to the previous code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00162}00162                             \textcolor{keywordflow}{if} ((i -\/ 1) < HLIT) value = bitlen[i -\/ 1];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00163}00163                             \textcolor{keywordflow}{else} value = bitlenD[i -\/ HLIT -\/ 1];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00164}00164                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} n = 0; n < replength; n++) \textcolor{comment}{//repeat this value in the next lengths}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00165}00165                             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00166}00166                                 \textcolor{keywordflow}{if} (i >= HLIT + HDIST) \{ error = 13; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: i is larger than the amount of codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00167}00167                                 \textcolor{keywordflow}{if} (i < HLIT) bitlen[i++] = value; \textcolor{keywordflow}{else} bitlenD[i++ -\/ HLIT] = value;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00168}00168                             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00169}00169                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == 17) \textcolor{comment}{//repeat "{}0"{} 3-\/10 times}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00170}00170                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00171}00171                             \textcolor{keywordflow}{if} (bp >> 3 >= inlength) \{ error = 50; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer jumps past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00172}00172                             replength = 3 + readBitsFromStream(bp, in, 3);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00173}00173                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} n = 0; n < replength; n++) \textcolor{comment}{//repeat this value in the next lengths}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00174}00174                             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00175}00175                                 \textcolor{keywordflow}{if} (i >= HLIT + HDIST) \{ error = 14; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: i is larger than the amount of codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00176}00176                                 \textcolor{keywordflow}{if} (i < HLIT) bitlen[i++] = 0; \textcolor{keywordflow}{else} bitlenD[i++ -\/ HLIT] = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00177}00177                             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00178}00178                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == 18) \textcolor{comment}{//repeat "{}0"{} 11-\/138 times}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00179}00179                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00180}00180                             \textcolor{keywordflow}{if} (bp >> 3 >= inlength) \{ error = 50; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer jumps past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00181}00181                             replength = 11 + readBitsFromStream(bp, in, 7);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00182}00182                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} n = 0; n < replength; n++) \textcolor{comment}{//repeat this value in the next lengths}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00183}00183                             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00184}00184                                 \textcolor{keywordflow}{if} (i >= HLIT + HDIST) \{ error = 15; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: i is larger than the amount of codes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00185}00185                                 \textcolor{keywordflow}{if} (i < HLIT) bitlen[i++] = 0; \textcolor{keywordflow}{else} bitlenD[i++ -\/ HLIT] = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00186}00186                             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00187}00187                         \} \textcolor{keywordflow}{else} \{ error = 16; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: somehow an unexisting code appeared. This can never happen.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00188}00188                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00189}00189                     \textcolor{keywordflow}{if} (bitlen[256] == 0) \{ error = 64; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//the length of the end code 256 must be larger than 0}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00190}00190                     error = tree.makeFromLengths(bitlen, 15); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return}; \textcolor{comment}{//now we've finally got HLIT and HDIST, so generate the code trees, and the function is done}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00191}00191                     error = treeD.makeFromLengths(bitlenD, 15); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00192}00192                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00193}00193                 \textcolor{keywordtype}{void} inflateHuffmanBlock(std::vector<unsigned char>\& out, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t}\& bp, \textcolor{keywordtype}{size\_t}\& pos, \textcolor{keywordtype}{size\_t} inlength, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} btype)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00194}00194                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00195}00195                     \textcolor{keywordflow}{if} (btype == 1) \{ generateFixedTrees(codetree, codetreeD); \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (btype == 2) \{ getTreeInflateDynamic(codetree, codetreeD, in, bp, inlength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return}; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00196}00196                     \textcolor{keywordflow}{for} (;;)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00197}00197                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00198}00198                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} code = huffmanDecodeSymbol(in, bp, codetree, inlength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00199}00199                         \textcolor{keywordflow}{if} (code == 256) \textcolor{keywordflow}{return}; \textcolor{comment}{//end code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00200}00200                         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code <= 255) \textcolor{comment}{//literal symbol}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00201}00201                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00202}00202                             \textcolor{keywordflow}{if} (pos >= out.size()) out.resize((pos + 1) * 2); \textcolor{comment}{//reserve more room}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00203}00203                             out[pos++] = (\textcolor{keywordtype}{unsigned} char)(code);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00204}00204                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code >= 257 \&\& code <= 285) \textcolor{comment}{//length code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00205}00205                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00206}00206                             \textcolor{keywordtype}{size\_t} length = LENBASE[code -\/ 257], numextrabits = LENEXTRA[code -\/ 257];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00207}00207                             \textcolor{keywordflow}{if} ((bp >> 3) >= inlength) \{ error = 51; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer will jump past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00208}00208                             length += readBitsFromStream(bp, in, numextrabits);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00209}00209                             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} codeD = huffmanDecodeSymbol(in, bp, codetreeD, inlength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00210}00210                             \textcolor{keywordflow}{if} (codeD > 29) \{ error = 18; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: invalid dist code (30-\/31 are never used)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00211}00211                             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} dist = DISTBASE[codeD], numextrabitsD = DISTEXTRA[codeD];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00212}00212                             \textcolor{keywordflow}{if} ((bp >> 3) >= inlength) \{ error = 51; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer will jump past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00213}00213                             dist += readBitsFromStream(bp, in, numextrabitsD);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00214}00214                             \textcolor{keywordtype}{size\_t} start = pos, back = start -\/ dist; \textcolor{comment}{//backwards}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00215}00215                             \textcolor{keywordflow}{if} (pos + length >= out.size()) out.resize((pos + length) * 2); \textcolor{comment}{//reserve more room}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00216}00216                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < length; i++) \{ out[pos++] = out[back++]; \textcolor{keywordflow}{if} (back >= start) back = start -\/ dist; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00217}00217                         \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00218}00218                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00219}00219                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00220}00220                 \textcolor{keywordtype}{void} inflateNoCompression(std::vector<unsigned char>\& out, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t}\& bp, \textcolor{keywordtype}{size\_t}\& pos, \textcolor{keywordtype}{size\_t} inlength)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00221}00221                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00222}00222                     \textcolor{keywordflow}{while} ((bp \& 0x7) != 0) bp++; \textcolor{comment}{//go to first boundary of byte}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00223}00223                     \textcolor{keywordtype}{size\_t} p = bp / 8;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00224}00224                     \textcolor{keywordflow}{if} (p >= inlength -\/ 4) \{ error = 52; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error, bit pointer will jump past memory}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00225}00225                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} LEN = in[p] + 256 * in[p + 1], NLEN = in[p + 2] + 256 * in[p + 3]; p += 4;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00226}00226                     \textcolor{keywordflow}{if} (LEN + NLEN != 65535) \{ error = 21; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: NLEN is not one's complement of LEN}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00227}00227                     \textcolor{keywordflow}{if} (pos + LEN >= out.size()) out.resize(pos + LEN);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00228}00228                     \textcolor{keywordflow}{if} (p + LEN > inlength) \{ error = 23; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: reading outside of in buffer}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00229}00229                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} n = 0; n < LEN; n++) out[pos++] = in[p++]; \textcolor{comment}{//read LEN bytes of literal data}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00230}00230                     bp = p * 8;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00231}00231                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00232}00232             \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00233}00233             \textcolor{keywordtype}{int} decompress(std::vector<unsigned char>\& out, \textcolor{keyword}{const} std::vector<unsigned char>\& in) \textcolor{comment}{//returns error value}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00234}00234             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00235}00235                 Inflator inflator;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00236}00236                 \textcolor{keywordflow}{if} (in.size() < 2) \{ \textcolor{keywordflow}{return} 53; \} \textcolor{comment}{//error, size of zlib data too small}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00237}00237                 \textcolor{keywordflow}{if} ((in[0] * 256 + in[1]) \% 31 != 0) \{ \textcolor{keywordflow}{return} 24; \} \textcolor{comment}{//error: 256 * in[0] + in[1] must be a multiple of 31, the FCHECK value is supposed to be made that way}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00238}00238                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} CM = in[0] \& 15, CINFO = (in[0] >> 4) \& 15, FDICT = (in[1] >> 5) \& 1;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00239}00239                 \textcolor{keywordflow}{if} (CM != 8 || CINFO > 7) \{ \textcolor{keywordflow}{return} 25; \} \textcolor{comment}{//error: only compression method 8: inflate with sliding window of 32k is supported by the PNG spec}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00240}00240                 \textcolor{keywordflow}{if} (FDICT != 0) \{ \textcolor{keywordflow}{return} 26; \} \textcolor{comment}{//error: the specification of PNG says about the zlib stream: "{}The additional flags shall not specify a preset dictionary."{}}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00241}00241                 inflator.inflate(out, in, 2);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00242}00242                 \textcolor{keywordflow}{return} inflator.error; \textcolor{comment}{//note: adler32 checksum was skipped and ignored}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00243}00243             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00244}00244         \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00245}00245         \textcolor{keyword}{struct }PNG \textcolor{comment}{//nested functions for PNG decoding}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00246}00246         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00247}00247             \textcolor{keyword}{struct }Info}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00248}00248             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00249}00249                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} width, height, colorType, bitDepth, compressionMethod, filterMethod, interlaceMethod, key\_r, key\_g, key\_b;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00250}00250                 \textcolor{keywordtype}{bool} key\_defined; \textcolor{comment}{//is a transparent color key given?}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00251}00251                 std::vector<unsigned char> palette;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00252}00252             \} info;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00253}00253             \textcolor{keywordtype}{int} error;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00254}00254             \textcolor{keywordtype}{void} decode(std::vector<unsigned char>\& out, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t} size, \textcolor{keywordtype}{bool} convert\_to\_rgba32)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00255}00255             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00256}00256                 error = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00257}00257                 \textcolor{keywordflow}{if} (size == 0 || in == 0) \{ error = 48; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//the given data is empty}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00258}00258                 readPngHeader(\&in[0], size); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00259}00259                 \textcolor{keywordtype}{size\_t} pos = 33; \textcolor{comment}{//first byte of the first chunk after the header}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00260}00260                 std::vector<unsigned char> idat; \textcolor{comment}{//the data from idat chunks}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00261}00261                 \textcolor{keywordtype}{bool} IEND = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00262}00262                 info.key\_defined = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00263}00263                 \textcolor{keywordflow}{while} (!IEND) \textcolor{comment}{//loop through the chunks, ignoring unknown chunks and stopping at IEND chunk. IDAT data is put at the start of the in buffer}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00264}00264                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00265}00265                     \textcolor{keywordflow}{if} (pos + 8 >= size) \{ error = 30; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: size of the in buffer too small to contain next chunk}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00266}00266                     \textcolor{keywordtype}{size\_t} chunkLength = read32bitInt(\&in[pos]); pos += 4;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00267}00267                     \textcolor{keywordflow}{if} (chunkLength > 2147483647) \{ error = 63; \textcolor{keywordflow}{return}; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00268}00268                     \textcolor{keywordflow}{if} (pos + chunkLength >= size) \{ error = 35; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: size of the in buffer too small to contain next chunk}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00269}00269                     \textcolor{keywordflow}{if} (in[pos + 0] == \textcolor{charliteral}{'I'} \&\& in[pos + 1] == \textcolor{charliteral}{'D'} \&\& in[pos + 2] == \textcolor{charliteral}{'A'} \&\& in[pos + 3] == \textcolor{charliteral}{'T'}) \textcolor{comment}{//IDAT chunk, containing compressed image data}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00270}00270                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00271}00271                         idat.insert(idat.end(), \&in[pos + 4], \&in[pos + 4 + chunkLength]);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00272}00272                         pos += (4 + chunkLength);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00273}00273                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (in[pos + 0] == \textcolor{charliteral}{'I'} \&\& in[pos + 1] == \textcolor{charliteral}{'E'} \&\& in[pos + 2] == \textcolor{charliteral}{'N'} \&\& in[pos + 3] == \textcolor{charliteral}{'D'})  \{ pos += 4; IEND = \textcolor{keyword}{true}; \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (in[pos + 0] == \textcolor{charliteral}{'P'} \&\& in[pos + 1] == \textcolor{charliteral}{'L'} \&\& in[pos + 2] == \textcolor{charliteral}{'T'} \&\& in[pos + 3] == \textcolor{charliteral}{'E'}) \textcolor{comment}{//palette chunk (PLTE)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00274}00274                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00275}00275                         pos += 4; \textcolor{comment}{//go after the 4 letters}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00276}00276                         info.palette.resize(4 * (chunkLength / 3));}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00277}00277                         \textcolor{keywordflow}{if} (info.palette.size() > (4 * 256)) \{ error = 38; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: palette too big}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00278}00278                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < info.palette.size(); i += 4)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00279}00279                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00280}00280                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < 3; j++) info.palette[i + j] = in[pos++]; \textcolor{comment}{//RGB}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00281}00281                             info.palette[i + 3] = 255; \textcolor{comment}{//alpha}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00282}00282                         \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00283}00283                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (in[pos + 0] == \textcolor{charliteral}{'t'} \&\& in[pos + 1] == \textcolor{charliteral}{'R'} \&\& in[pos + 2] == \textcolor{charliteral}{'N'} \&\& in[pos + 3] == \textcolor{charliteral}{'S'}) \textcolor{comment}{//palette transparency chunk (tRNS)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00284}00284                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00285}00285                         pos += 4; \textcolor{comment}{//go after the 4 letters}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00286}00286                         \textcolor{keywordflow}{if} (info.colorType == 3)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00287}00287                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00288}00288                             \textcolor{keywordflow}{if} (4 * chunkLength > info.palette.size()) \{ error = 39; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: more alpha values given than there are palette entries}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00289}00289                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < chunkLength; i++) info.palette[4 * i + 3] = in[pos++];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00290}00290                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (info.colorType == 0)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00291}00291                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00292}00292                             \textcolor{keywordflow}{if} (chunkLength != 2) \{ error = 40; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: this chunk must be 2 bytes for greyscale image}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00293}00293                             info.key\_defined = 1; info.key\_r = info.key\_g = info.key\_b = 256 * in[pos] + in[pos + 1]; pos += 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00294}00294                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (info.colorType == 2)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00295}00295                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00296}00296                             \textcolor{keywordflow}{if} (chunkLength != 6) \{ error = 41; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: this chunk must be 6 bytes for RGB image}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00297}00297                             info.key\_defined = 1;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00298}00298                             info.key\_r = 256 * in[pos] + in[pos + 1]; pos += 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00299}00299                             info.key\_g = 256 * in[pos] + in[pos + 1]; pos += 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00300}00300                             info.key\_b = 256 * in[pos] + in[pos + 1]; pos += 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00301}00301                         \} \textcolor{keywordflow}{else} \{ error = 42; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: tRNS chunk not allowed for other color models}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00302}00302                     \} \textcolor{keywordflow}{else} \textcolor{comment}{//it's not an implemented chunk type, so ignore it: skip over the data}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00303}00303                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00304}00304                         \textcolor{keywordflow}{if} (!(in[pos + 0] \& 32)) \{ error = 69; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: unknown critical chunk (5th bit of first byte of chunk type is 0)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00305}00305                         pos += (chunkLength + 4); \textcolor{comment}{//skip 4 letters and uninterpreted data of unimplemented chunk}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00306}00306                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00307}00307                     pos += 4; \textcolor{comment}{//step over CRC (which is ignored)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00308}00308                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00309}00309                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bpp = getBpp(info);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00310}00310                 std::vector<unsigned char> scanlines(((info.width * (info.height * bpp + 7)) / 8) + info.height); \textcolor{comment}{//now the out buffer will be filled}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00311}00311                 Zlib zlib; \textcolor{comment}{//decompress with the Zlib decompressor}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00312}00312                 error = zlib.decompress(scanlines, idat); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return}; \textcolor{comment}{//stop if the zlib decompressor returned an error}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00313}00313                 \textcolor{keywordtype}{size\_t} bytewidth = (bpp + 7) / 8, outlength = (info.height * info.width * bpp + 7) / 8;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00314}00314                 out.resize(outlength); \textcolor{comment}{//time to fill the out buffer}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00315}00315                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* out\_ = outlength ? \&out[0] : 0; \textcolor{comment}{//use a regular pointer to the std::vector for faster code if compiled without optimization}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00316}00316                 \textcolor{keywordflow}{if} (info.interlaceMethod == 0) \textcolor{comment}{//no interlace, just filter}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00317}00317                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00318}00318                     \textcolor{keywordtype}{size\_t} linestart = 0, linelength = (info.width * bpp + 7) / 8; \textcolor{comment}{//length in bytes of a scanline, excluding the filtertype byte}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00319}00319                     \textcolor{keywordflow}{if} (bpp >= 8) \textcolor{comment}{//byte per byte}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00320}00320                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} y = 0; y < info.height; y++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00321}00321                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00322}00322                         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} filterType = scanlines[linestart];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00323}00323                         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* prevline = (y == 0) ? 0 : \&out\_[(y -\/ 1) * info.width * bytewidth];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00324}00324                         unFilterScanline(\&out\_[linestart -\/ y], \&scanlines[linestart + 1], prevline, bytewidth, filterType, linelength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00325}00325                         linestart += (1 + linelength); \textcolor{comment}{//go to start of next scanline}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00326}00326                     \} \textcolor{keywordflow}{else} \textcolor{comment}{//less than 8 bits per pixel, so fill it up bit per bit}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00327}00327                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00328}00328                         std::vector<unsigned char> templine((info.width * bpp + 7) >> 3); \textcolor{comment}{//only used if bpp < 8}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00329}00329                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} y = 0, obp = 0; y < info.height; y++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00330}00330                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00331}00331                             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} filterType = scanlines[linestart];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00332}00332                             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* prevline = (y == 0) ? 0 : \&out\_[(y -\/ 1) * info.width * bytewidth];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00333}00333                             unFilterScanline(\&templine[0], \&scanlines[linestart + 1], prevline, bytewidth, filterType, linelength); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00334}00334                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} bp = 0; bp < info.width * bpp;) setBitOfReversedStream(obp, out\_, readBitFromReversedStream(bp, \&templine[0]));}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00335}00335                             linestart += (1 + linelength); \textcolor{comment}{//go to start of next scanline}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00336}00336                         \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00337}00337                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00338}00338                 \} \textcolor{keywordflow}{else} \textcolor{comment}{//interlaceMethod is 1 (Adam7)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00339}00339                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00340}00340                     \textcolor{keywordtype}{size\_t} passw[7] = \{ (info.width + 7) / 8, (info.width + 3) / 8, (info.width + 3) / 4, (info.width + 1) / 4, (info.width + 1) / 2, (info.width + 0) / 2, (info.width + 0) / 1 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00341}00341                     \textcolor{keywordtype}{size\_t} passh[7] = \{ (info.height + 7) / 8, (info.height + 7) / 8, (info.height + 3) / 8, (info.height + 3) / 4, (info.height + 1) / 4, (info.height + 1) / 2, (info.height + 0) / 2 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00342}00342                     \textcolor{keywordtype}{size\_t} passstart[7] = \{ 0 \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00343}00343                     \textcolor{keywordtype}{size\_t} pattern[28] = \{ 0, 4, 0, 2, 0, 1, 0, 0, 0, 4, 0, 2, 0, 1, 8, 8, 4, 4, 2, 2, 1, 8, 8, 8, 4, 4, 2, 2 \}; \textcolor{comment}{//values for the adam7 passes}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00344}00344                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 6; i++) passstart[i + 1] = passstart[i] + passh[i] * ((passw[i] ? 1 : 0) + (passw[i] * bpp + 7) / 8);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00345}00345                     std::vector<unsigned char> scanlineo((info.width * bpp + 7) / 8), scanlinen((info.width * bpp + 7) / 8); \textcolor{comment}{//"{}old"{} and "{}new"{} scanline}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00346}00346                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 7; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00347}00347                         adam7Pass(\&out\_[0], \&scanlinen[0], \&scanlineo[0], \&scanlines[passstart[i]], info.width, pattern[i], pattern[i + 7], pattern[i + 14], pattern[i + 21], passw[i], passh[i], bpp);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00348}00348                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00349}00349                 \textcolor{keywordflow}{if} (convert\_to\_rgba32 \&\& (info.colorType != 6 || info.bitDepth != 8)) \textcolor{comment}{//conversion needed}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00350}00350                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00351}00351                     std::vector<unsigned char> data = out;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00352}00352                     error = convert(out, \&data[0], info, info.width, info.height);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00353}00353                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00354}00354             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00355}00355             \textcolor{keywordtype}{void} readPngHeader(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{size\_t} inlength) \textcolor{comment}{//read the information from the header and store it in the Info}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00356}00356             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00357}00357                 \textcolor{keywordflow}{if} (inlength < 29) \{ error = 27; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: the data length is smaller than the length of the header}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00358}00358                 \textcolor{keywordflow}{if} (in[0] != 137 || in[1] != 80 || in[2] != 78 || in[3] != 71 || in[4] != 13 || in[5] != 10 || in[6] != 26 || in[7] != 10) \{ error = 28; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//no PNG signature}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00359}00359                 \textcolor{keywordflow}{if} (in[12] != \textcolor{charliteral}{'I'} || in[13] != \textcolor{charliteral}{'H'} || in[14] != \textcolor{charliteral}{'D'} || in[15] != \textcolor{charliteral}{'R'}) \{ error = 29; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: it doesn't start with a IHDR chunk!}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00360}00360                 info.width = read32bitInt(\&in[16]); info.height = read32bitInt(\&in[20]);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00361}00361                 info.bitDepth = in[24]; info.colorType = in[25];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00362}00362                 info.compressionMethod = in[26]; \textcolor{keywordflow}{if} (in[26] != 0) \{ error = 32; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: only compression method 0 is allowed in the specification}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00363}00363                 info.filterMethod = in[27]; \textcolor{keywordflow}{if} (in[27] != 0) \{ error = 33; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: only filter method 0 is allowed in the specification}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00364}00364                 info.interlaceMethod = in[28]; \textcolor{keywordflow}{if} (in[28] > 1) \{ error = 34; \textcolor{keywordflow}{return}; \} \textcolor{comment}{//error: only interlace methods 0 and 1 exist in the specification}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00365}00365                 error = checkColorValidity(info.colorType, info.bitDepth);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00366}00366             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00367}00367             \textcolor{keywordtype}{void} unFilterScanline(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* recon, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* scanline, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* precon, \textcolor{keywordtype}{size\_t} bytewidth, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} filterType, \textcolor{keywordtype}{size\_t} length)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00368}00368             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00369}00369                 \textcolor{keywordflow}{switch} (filterType)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00370}00370                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00371}00371                     \textcolor{keywordflow}{case} 0: \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < length; i++) recon[i] = scanline[i]; \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00372}00372                     \textcolor{keywordflow}{case} 1:}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00373}00373                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bytewidth; i++) recon[i] = scanline[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00374}00374                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = bytewidth; i < length; i++) recon[i] = scanline[i] + recon[i -\/ bytewidth];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00375}00375                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00376}00376                     \textcolor{keywordflow}{case} 2:}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00377}00377                         \textcolor{keywordflow}{if} (precon) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < length; i++) recon[i] = scanline[i] + precon[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00378}00378                         \textcolor{keywordflow}{else}       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < length; i++) recon[i] = scanline[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00379}00379                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00380}00380                     \textcolor{keywordflow}{case} 3:}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00381}00381                         \textcolor{keywordflow}{if} (precon)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00382}00382                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00383}00383                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bytewidth; i++) recon[i] = scanline[i] + precon[i] / 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00384}00384                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = bytewidth; i < length; i++) recon[i] = scanline[i] + ((recon[i -\/ bytewidth] + precon[i]) / 2);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00385}00385                         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00386}00386                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00387}00387                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bytewidth; i++) recon[i] = scanline[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00388}00388                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = bytewidth; i < length; i++) recon[i] = scanline[i] + recon[i -\/ bytewidth] / 2;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00389}00389                         \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00390}00390                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00391}00391                     \textcolor{keywordflow}{case} 4:}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00392}00392                         \textcolor{keywordflow}{if} (precon)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00393}00393                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00394}00394                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bytewidth; i++) recon[i] = scanline[i] + paethPredictor(0, precon[i], 0);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00395}00395                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = bytewidth; i < length; i++) recon[i] = scanline[i] + paethPredictor(recon[i -\/ bytewidth], precon[i], precon[i -\/ bytewidth]);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00396}00396                         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00397}00397                         \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00398}00398                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < bytewidth; i++) recon[i] = scanline[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00399}00399                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = bytewidth; i < length; i++) recon[i] = scanline[i] + paethPredictor(recon[i -\/ bytewidth], 0, 0);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00400}00400                         \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00401}00401                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00402}00402                     \textcolor{keywordflow}{default}: error = 36; \textcolor{keywordflow}{return}; \textcolor{comment}{//error: unexisting filter type given}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00403}00403                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00404}00404             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00405}00405             \textcolor{keywordtype}{void} adam7Pass(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* out, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* linen, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* lineo, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} w, \textcolor{keywordtype}{size\_t} passleft, \textcolor{keywordtype}{size\_t} passtop, \textcolor{keywordtype}{size\_t} spacex, \textcolor{keywordtype}{size\_t} spacey, \textcolor{keywordtype}{size\_t} passw, \textcolor{keywordtype}{size\_t} passh, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bpp)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00406}00406             \{ \textcolor{comment}{//filter and reposition the pixels into the output when the image is Adam7 interlaced. This function can only do it after the full image is already decoded. The out buffer must have the correct allocated memory size already.}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00407}00407                 \textcolor{keywordflow}{if} (passw == 0) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00408}00408                 \textcolor{keywordtype}{size\_t} bytewidth = (bpp + 7) / 8, linelength = 1 + ((bpp * passw + 7) / 8);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00409}00409                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} y = 0; y < passh; y++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00410}00410                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00411}00411                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} filterType = in[y * linelength], *prevline = (y == 0) ? 0 : lineo;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00412}00412                     unFilterScanline(linen, \&in[y * linelength + 1], prevline, bytewidth, filterType, (w * bpp + 7) / 8); \textcolor{keywordflow}{if} (error) \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00413}00413                     \textcolor{keywordflow}{if} (bpp >= 8) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < passw; i++) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} b = 0; b < bytewidth; b++) \textcolor{comment}{//b = current byte of this pixel}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00414}00414                         out[bytewidth * w * (passtop + spacey * y) + bytewidth * (passleft + spacex * i) + b] = linen[bytewidth * i + b];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00415}00415                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < passw; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00416}00416                     \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00417}00417                         \textcolor{keywordtype}{size\_t} obp = bpp * w * (passtop + spacey * y) + bpp * (passleft + spacex * i), bp = i * bpp;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00418}00418                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} b = 0; b < bpp; b++) setBitOfReversedStream(obp, out, readBitFromReversedStream(bp, \&linen[0]));}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00419}00419                     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00420}00420                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* temp = linen; linen = lineo; lineo = temp; \textcolor{comment}{//swap the two buffer pointers "{}line old"{} and "{}line new"{}}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00421}00421                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00422}00422             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00423}00423             \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} readBitFromReversedStream(\textcolor{keywordtype}{size\_t}\& bitp, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* bits) \{ \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} result = (bits[bitp >> 3] >> (7 -\/ (bitp \& 0x7))) \& 1; bitp++; \textcolor{keywordflow}{return} result; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00424}00424             \textcolor{keyword}{static} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} readBitsFromReversedStream(\textcolor{keywordtype}{size\_t}\& bitp, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* bits, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nbits)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00425}00425             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00426}00426                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} result = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00427}00427                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = nbits -\/ 1; i < nbits; i-\/-\/) result += ((readBitFromReversedStream(bitp, bits)) << i);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00428}00428                 \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00429}00429             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00430}00430             \textcolor{keywordtype}{void} setBitOfReversedStream(\textcolor{keywordtype}{size\_t}\& bitp, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* bits, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bit) \{ bits[bitp >> 3] |= (bit << (7 -\/ (bitp \& 0x7))); bitp++; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00431}00431             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} read32bitInt(\textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* buffer) \{ \textcolor{keywordflow}{return} (buffer[0] << 24) | (buffer[1] << 16) | (buffer[2] << 8) | buffer[3]; \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00432}00432             \textcolor{keywordtype}{int} checkColorValidity(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} colorType, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} bd) \textcolor{comment}{//return type is a LodePNG error code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00433}00433             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00434}00434                 \textcolor{keywordflow}{if} ((colorType == 2 || colorType == 4 || colorType == 6)) \{ \textcolor{keywordflow}{if} (!(bd == 8 || bd == 16)) \textcolor{keywordflow}{return} 37; \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} 0; \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (colorType == 0) \{ \textcolor{keywordflow}{if} (!(bd == 1 || bd == 2 || bd == 4 || bd == 8 || bd == 16)) \textcolor{keywordflow}{return} 37; \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} 0; \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (colorType == 3) \{ \textcolor{keywordflow}{if} (!(bd == 1 || bd == 2 || bd == 4 || bd == 8)) \textcolor{keywordflow}{return} 37; \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} 0; \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} 31; \textcolor{comment}{//unexisting color type}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00435}00435             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00436}00436             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} getBpp(\textcolor{keyword}{const} Info\& info)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00437}00437             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00438}00438                 \textcolor{keywordflow}{if} (info.colorType == 2) \textcolor{keywordflow}{return} (3 * info.bitDepth);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00439}00439                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (info.colorType >= 4) \textcolor{keywordflow}{return} (info.colorType -\/ 2) * info.bitDepth;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00440}00440                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} info.bitDepth;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00441}00441             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00442}00442             \textcolor{keywordtype}{int} convert(std::vector<unsigned char>\& out, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* in, Info\& infoIn, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} w, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} h)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00443}00443             \{ \textcolor{comment}{//converts from any color type to 32-\/bit. return value = LodePNG error code}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00444}00444                 \textcolor{keywordtype}{size\_t} numpixels = w * h, bp = 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00445}00445                 out.resize(numpixels * 4);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00446}00446                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}* out\_ = out.empty() ? 0 : \&out[0]; \textcolor{comment}{//faster if compiled without optimization}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00447}00447                 \textcolor{keywordflow}{if} (infoIn.bitDepth == 8 \&\& infoIn.colorType == 0) \textcolor{comment}{//greyscale}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00448}00448                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00449}00449                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00450}00450                     out\_[4 * i + 0] = out\_[4 * i + 1] = out\_[4 * i + 2] = in[i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00451}00451                     out\_[4 * i + 3] = (infoIn.key\_defined \&\& in[i] == infoIn.key\_r) ? 0 : 255;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00452}00452                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 8 \&\& infoIn.colorType == 2) \textcolor{comment}{//RGB color}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00453}00453                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00454}00454                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00455}00455                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 3; c++) out\_[4 * i + c] = in[3 * i + c];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00456}00456                     out\_[4 * i + 3] = (infoIn.key\_defined == 1 \&\& in[3 * i + 0] == infoIn.key\_r \&\& in[3 * i + 1] == infoIn.key\_g \&\& in[3 * i + 2] == infoIn.key\_b) ? 0 : 255;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00457}00457                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 8 \&\& infoIn.colorType == 3) \textcolor{comment}{//indexed color (palette)}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00458}00458                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00459}00459                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00460}00460                     \textcolor{keywordflow}{if} (4U * in[i] >= infoIn.palette.size()) \textcolor{keywordflow}{return} 46;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00461}00461                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 4; c++) out\_[4 * i + c] = infoIn.palette[4 * in[i] + c]; \textcolor{comment}{//get rgb colors from the palette}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00462}00462                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 8 \&\& infoIn.colorType == 4) \textcolor{comment}{//greyscale with alpha}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00463}00463                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00464}00464                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00465}00465                     out\_[4 * i + 0] = out\_[4 * i + 1] = out\_[4 * i + 2] = in[2 * i + 0];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00466}00466                     out\_[4 * i + 3] = in[2 * i + 1];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00467}00467                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 8 \&\& infoIn.colorType == 6) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 4; c++) out\_[4 * i + c] = in[4 * i + c]; \textcolor{comment}{//RGB with alpha}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00468}00468                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 16 \&\& infoIn.colorType == 0) \textcolor{comment}{//greyscale}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00469}00469                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00470}00470                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00471}00471                     out\_[4 * i + 0] = out\_[4 * i + 1] = out\_[4 * i + 2] = in[2 * i];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00472}00472                     out\_[4 * i + 3] = (infoIn.key\_defined \&\& 256U * in[i] + in[i + 1] == infoIn.key\_r) ? 0 : 255;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00473}00473                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 16 \&\& infoIn.colorType == 2) \textcolor{comment}{//RGB color}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00474}00474                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00475}00475                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00476}00476                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 3; c++) out\_[4 * i + c] = in[6 * i + 2 * c];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00477}00477                     out\_[4 * i + 3] = (infoIn.key\_defined \&\& 256U * in[6 * i + 0] + in[6 * i + 1] == infoIn.key\_r \&\& 256U * in[6 * i + 2] + in[6 * i + 3] == infoIn.key\_g \&\& 256U * in[6 * i + 4] + in[6 * i + 5] == infoIn.key\_b) ? 0 : 255;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00478}00478                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 16 \&\& infoIn.colorType == 4) \textcolor{comment}{//greyscale with alpha}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00479}00479                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00480}00480                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00481}00481                     out\_[4 * i + 0] = out\_[4 * i + 1] = out\_[4 * i + 2] = in[4 * i]; \textcolor{comment}{//most significant byte}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00482}00482                     out\_[4 * i + 3] = in[4 * i + 2];}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00483}00483                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth == 16 \&\& infoIn.colorType == 6) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++) \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 4; c++) out\_[4 * i + c] = in[8 * i + 2 * c]; \textcolor{comment}{//RGB with alpha}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00484}00484                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth < 8 \&\& infoIn.colorType == 0) \textcolor{comment}{//greyscale}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00485}00485                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00486}00486                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00487}00487                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} value = (readBitsFromReversedStream(bp, in, infoIn.bitDepth) * 255) / ((1 << infoIn.bitDepth) -\/ 1); \textcolor{comment}{//scale value from 0 to 255}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00488}00488                     out\_[4 * i + 0] = out\_[4 * i + 1] = out\_[4 * i + 2] = (\textcolor{keywordtype}{unsigned} char)(value);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00489}00489                     out\_[4 * i + 3] = (infoIn.key\_defined \&\& value \&\& ((1U << infoIn.bitDepth) -\/ 1U) == infoIn.key\_r \&\& ((1U << infoIn.bitDepth) -\/ 1U)) ? 0 : 255;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00490}00490                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (infoIn.bitDepth < 8 \&\& infoIn.colorType == 3) \textcolor{comment}{//palette}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00491}00491                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < numpixels; i++)}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00492}00492                 \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00493}00493                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} value = readBitsFromReversedStream(bp, in, infoIn.bitDepth);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00494}00494                     \textcolor{keywordflow}{if} (4 * value >= infoIn.palette.size()) \textcolor{keywordflow}{return} 47;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00495}00495                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} c = 0; c < 4; c++) out\_[4 * i + c] = infoIn.palette[4 * value + c]; \textcolor{comment}{//get rgb colors from the palette}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00496}00496                 \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00497}00497                 \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00498}00498             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00499}00499             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} paethPredictor(\textcolor{keywordtype}{short} a, \textcolor{keywordtype}{short} b, \textcolor{keywordtype}{short} c) \textcolor{comment}{//Paeth predicter, used by PNG filter type 4}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00500}00500             \{}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00501}00501                 \textcolor{keywordtype}{short} p = a + b -\/ c, pa = p > a ? (p -\/ a) : (a -\/ p), pb = p > b ? (p -\/ b) : (b -\/ p), pc = p > c ? (p -\/ c) : (c -\/ p);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00502}00502                 \textcolor{keywordflow}{return} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})((pa <= pb \&\& pa <= pc) ? a : pb <= pc ? b : c);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00503}00503             \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00504}00504         \};}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00505}00505         PNG decoder; decoder.decode(out\_image, in\_png, in\_size, convert\_to\_rgba32);}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00506}00506         image\_width = decoder.info.width; image\_height = decoder.info.height;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00507}00507         \textcolor{keywordflow}{return} decoder.error;}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00508}00508     \}}
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00509}00509 }
\DoxyCodeLine{\Hypertarget{_pico_p_n_g_8cpp_source_l00510}00510 \}}

\end{DoxyCode}
